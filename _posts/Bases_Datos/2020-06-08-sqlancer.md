---

author_profile: true
comments: false
classes: wide
tags:
- SQLancer
categories:
- Bases de Datos
header:
  teaser: /assets/images/blog/logo-sqlancer.webp
  overlay_image: /assets/images/blog/logo-sqlancer.webp
  overlay_filter: 0.2
  image_description: 'SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).'
  image_alt: 'SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).'
title: 'SQLancer: DetecciÃ³n de errores lÃ³gicos en DBMS o sistema de gestiÃ³n de bases de datos'
description: >-
  SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).
excerpt: >-
  SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).
canonical_URL: https://ciberninjas.com/sqlancer/
permalink: /sqlancer/
date: 2020-06-09 18:32:32
last_modified_at: 
published: true

---

SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).

SQLancer opera en las siguientes dos fases:

- GeneraciÃ³n de base de datos: El objetivo de esta fase es crear una base de datos poblada y hacer hincapiÃ© en el DBMS para aumentar la probabilidad de causar un estado de base de datos inconsistente que podrÃ­a detectarse posteriormente. Primero, se crean tablas aleatorias. Luego, se eligen al azar sentencias SQL para generar, modificar y eliminar datos. TambiÃ©n se envÃ­an al DBMS otras declaraciones, como aquellas para crear Ã­ndices, asÃ­ como vistas y para establecer opciones especÃ­ficas de DBMS.
- Pruebas: el objetivo de esta fase es detectar los errores lÃ³gicos basados â€‹â€‹en la base de datos generada. Vea los enfoques de prueba a continuaciÃ³n.

## **Empezando con SQLancer**

Requisitos:

- Java 11
- [Maven](https://maven.apache.org/){:target="_blank" rel="nofollow,noreferrer"} ( `sudo apt install maven`en Ubuntu)
- El DBMS que desea probar (SQLite es un DBMS incorporado y estÃ¡ incluido)

Los siguientes comandos clonan SQLancer, crean un JAR e inician SQLancer para difuminar SQLite usando el Particionamiento de consultas lÃ³gicas ternarias (TLP):

```
git clone https://github.com/sqlancer/sqlancer
cd sqlancer
mvn package
cd target
java -jar SQLancer-0.0.1-SNAPSHOT.jar --num_threads 16 --num_tries 5 --max_expression_depth 3 --num_queries 100000 --max_num_inserts 30 sqlite3 --oracle query_partitioning
```

Si la ejecuciÃ³n imprime informaciÃ³n de progreso cada cinco segundos, la herramienta funciona como se esperaba. Tenga en cuenta que SQLancer puede encontrar errores en SQLite. Antes de informar sobre esto, asegÃºrese de verificar que todavÃ­a puedan reproducirse cuando use la Ãºltima versiÃ³n de desarrollo.

Si inicia SQLancer sin parÃ¡metros, se muestran las opciones y comandos disponibles.

## **Prototipo de investigaciÃ³n**

Este proyecto en esta etapa aÃºn debe verse como un prototipo de investigaciÃ³n. Creemos que la herramienta no estÃ¡ lista para ser utilizada. Sin embargo, hemos recibido muchas solicitudes de empresas, organizaciones y desarrolladores individuales, por lo que decidimos lanzar la herramienta prematuramente.

Espere errores, incompatibilidades, falta de documentaciÃ³n y calidad de cÃ³digo insuficiente. Dicho esto, estamos trabajando arduamente para abordar estos problemas y mejorar SQLancer para convertirnos en una pieza de software de calidad de producciÃ³n. Damos la bienvenida a cualquier informe de problemas, solicitudes de extensiÃ³n y contribuciones de cÃ³digo.

## **Enfoques de Pruebas**

| Acercarse                                                    | DescripciÃ³n                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| SÃ­ntesis de consulta pivotada (PQS)                          | PQS es la primera tÃ©cnica que diseÃ±amos e implementamos. Selecciona aleatoriamente una fila, llamada fila dinÃ¡mica, para la cual se genera una consulta que se garantiza que recuperarÃ¡ la fila. Si la fila no estÃ¡ contenida en el conjunto de resultados, se ha detectado un error. Se describe completamente [aquÃ­](https://arxiv.org/abs/2001.04174){:target="_blank" rel="nofollow,noreferrer"}. PQS es la tÃ©cnica mÃ¡s poderosa, pero tambiÃ©n requiere mÃ¡s esfuerzo de implementaciÃ³n que las otras dos tÃ©cnicas. Actualmente estÃ¡ sin mantenimiento. |
| ConstrucciÃ³n del motor de referencia sin optimizaciÃ³n (NoREC) | NoREC tiene como objetivo encontrar errores de optimizaciÃ³n. Se describe [aquÃ­](https://www.manuelrigger.at/preprints/NoREC.pdf){:target="_blank" rel="nofollow,noreferrer"}. Traduce una consulta que es potencialmente optimizada por el DBMS a una para la que casi ninguna optimizaciÃ³n es aplicable, y compara los dos conjuntos de resultados. Una falta de coincidencia entre los conjuntos de resultados indica un error en el DBMS. |
| Particionamiento lÃ³gico ternario (TLP)                       | TLP divide una consulta en tres consultas de particiÃ³n, cuyos resultados se componen y se comparan con el conjunto de resultados de la consulta original. Una falta de coincidencia en los conjuntos de resultados indica un error en el DBMS. A diferencia de NoREC y PQS, puede detectar errores en funciones avanzadas como funciones agregadas. |

## **DBMS Soportado**

Dado que los dialectos de SQL difieren ampliamente, cada DBMS a probar requiere una implementaciÃ³n separada.

| DBMS        | Estado     | GeneraciÃ³n de expresiones | DescripciÃ³n                                                  |
| ----------- | ---------- | ------------------------- | ------------------------------------------------------------ |
| SQLite      | Trabajando | Sin tipo                  | Actualmente, esta implementaciÃ³n se ve afectada por una regresiÃ³n significativa del rendimiento que aÃºn debe investigarse |
| MySQL       | Trabajando | Sin tipo                  | La ejecuciÃ³n de esta implementaciÃ³n probablemente descubre errores adicionales no reportados. |
| PostgreSQL  | Trabajando | Mecanografiado            |                                                              |
| MariaDB     | Preliminar | Sin tipo                  | La implementaciÃ³n de este DBMS es muy preliminar, ya que dejamos de extenderlo despuÃ©s de que se abordaron todos menos uno de nuestros informes de errores. Ejecutarlo probablemente descubre errores adicionales no reportados. |
| CucarachaDB | Trabajando | Mecanografiado            |                                                              |
| TiDB        | Trabajando | Sin tipo                  |                                                              |
| DuckDB      | Trabajando | Sin tipo, GenÃ©rico        |                                                              |
| ClickHouse  | Preliminar | Sin tipo, GenÃ©rico        | Implementar los diferentes motores de tabla no era conveniente, por lo que solo existe una implementaciÃ³n muy preliminar. |
| TDEngine    | Remoto     | Sin tipo                  | Eliminamos la implementaciÃ³n de TDEngine, ya que todos menos uno de nuestros informes de errores aÃºn no fueron abordados cinco meses despuÃ©s de que los informamos. |

# **IntegraciÃ³n continua y conjunto de pruebas**

Para mejorar y mantener la calidad del cÃ³digo de SQLancer, utilizamos varias herramientas:

- El [formateador de cÃ³digo Eclipse](https://code.revelc.net/formatter-maven-plugin/){:target="_blank" rel="nofollow,noreferrer"}, para garantizar un formato consistente (Ejecutar `mvn formatter:format`para formatear todos los archivos).
- [Checkstyle](https://checkstyle.sourceforge.io/){:target="_blank" rel="nofollow,noreferrer"}, para imponer un estÃ¡ndar de codificaciÃ³n consistente.
- [PMD](https://pmd.github.io/){:target="_blank" rel="nofollow,noreferrer"}, que encuentra fallas de programaciÃ³n mediante anÃ¡lisis estÃ¡tico.
- [SpotBugs](https://spotbugs.github.io/){:target="_blank" rel="nofollow,noreferrer"}, que tambiÃ©n utiliza anÃ¡lisis estÃ¡tico para encontrar errores y fallas de programaciÃ³n.

Puede ejecutarlos con el siguiente comando:

```
mvn verify
```

Planeamos agregar pronto un [CI](https://github.com/sqlancer/sqlancer/issues/2){:target="_blank" rel="nofollow,noreferrer"} para verificar automÃ¡ticamente los RP. Posteriormente, tambiÃ©n planeamos agregar pruebas de humo para cada DBMS para probar que la implementaciÃ³n de prueba respectiva no estÃ¡ obviamente rota, vea [aquÃ­](https://github.com/sqlancer/sqlancer/issues/3){:target="_blank" rel="nofollow,noreferrer"}.

SQLancer actualmente no tiene un conjunto de pruebas. Descubrimos que los errores en SQLancer se encuentran rÃ¡pidamente y son fÃ¡ciles de depurar al probar el DBMS. La implementaciÃ³n de PQS tenÃ­a un conjunto de pruebas, que se eliminÃ³ en commit 36ede0c0c68b3856e03ef5ba802a7c2575bb3f12.

## **Registros de SQLancer**

SQLancer almacena registros en el subdirectorio `target/logs`. De manera predeterminada, la opciÃ³n `--log-each-select` estÃ¡ habilitada, lo que da como resultado que se registre cada instrucciÃ³n SQL que se envÃ­e al DBMS. Los nombres de los archivos correspondientes se posponen con `-cur.log`. AdemÃ¡s, si SQLancer detecta un error lÃ³gico, crea un archivo con la extensiÃ³n `.log`, en el que se registran las declaraciones para reproducir el error.

## **ImplementaciÃ³n de soporte para un nuevo DBMS**

La implementaciÃ³n de DuckDB proporciona una buena plantilla para una nueva implementaciÃ³n. La clase `DuckDBProvider` es la clase central que gestiona la creaciÃ³n de las bases de datos y ejecuta los orÃ¡culos de prueba seleccionados. Intente copiar su estructura para el nuevo DBMS que desea implementar y comience por generar bases de datos (sin implementar un orÃ¡culo de prueba).

Como parte de esto, tambiÃ©n deberÃ¡ implementar el equivalente de `DuckDBSchema`, que representa el esquema de la base de datos de la base de datos generada. DespuÃ©s de que pueda generar bases de datos con Ã©xito, el siguiente paso es generar uno de los orÃ¡culos de prueba. Por ejemplo, es posible que desee implementar NoREC (consulte `DuckDBNoRECOracle` o `DuckDBQueryPartitioningWhereTester` para TLP).

Como parte de esto, tambiÃ©n debe implementar un generador de expresiones aleatorias (consulte `DuckDBExpressionGenerator`) y un visitante para derivar la representaciÃ³n textual de una expresiÃ³n (ver `DuckDBToStringVisitor`).

## **SQLancer con Eclipse**

Se espera que el desarrollo de SQLancer usando Eclipse funcione bien. Puede importar SQLancer con un solo paso:

```
File -> Import -> Existing Maven Projects -> Select the SQLancer directory as root directory -> Finish
```

Si no encuentra una opciÃ³n para importar proyectos de Maven, es posible que deba instalar el [complemento M2Eclipse](https://www.eclipse.org/m2e/){:target="_blank" rel="nofollow,noreferrer"}.

## **Comunidad de SQLancer**

Hemos creado un [espacio](https://join.slack.com/t/sqlancer/shared_invite/zt-eozrcao4-ieG29w1LNaBDMF7OB_~ACg){:target="_blank" rel="nofollow,noreferrer"} de [trabajo de Slack](https://join.slack.com/t/sqlancer/shared_invite/zt-eozrcao4-ieG29w1LNaBDMF7OB_~ACg){:target="_blank" rel="nofollow,noreferrer"} para analizar SQLancer y las pruebas de DBMS en general. El identificador oficial de Twitter de [SQLancer](https://twitter.com/sqlancer_dbms){:target="_blank" rel="nofollow,noreferrer"} es [@sqlancer_dbms](https://twitter.com/sqlancer_dbms){:target="_blank" rel="nofollow,noreferrer"}.

## **Recursos adicionales**

- Una charla de SÃ­ntesis de consulta pivotada (anterior) (PQS) estÃ¡ disponible en [YouTube](https://www.youtube.com/watch?v=yzENTaWe7qg){:target="_blank" rel="nofollow,noreferrer"}.
- PingCAP ha implementado PQS en una herramienta llamada [wreck-it](https://github.com/chaos-mesh/wreck-it){:target="_blank" rel="nofollow,noreferrer"}.
- MÃ¡s informaciÃ³n sobre nuestros esfuerzos de prueba de DBMS y los errores que encontramos estÃ¡ disponible [aquÃ­](https://www.manuelrigger.at/dbms-bugs/){:target="_blank" rel="nofollow,noreferrer"}.

> ğŸ”¥ Seguro tambiÃ©n te interesa: [CÃ³mo aprender Python en 2020](/python/), [ğŸ¥‡ â–· CÃ³mo aprender aprendizaje automÃ¡tico o machine learning en 2020 ğŸ¤–](/que-aprender-sobre-machine-learning-2020/), [â–· MÃ¡s de 200 de los mejores tutoriales de aprendizaje automÃ¡tico, PNL y Python](/aprendizaje-automatico-cursos-ingles/)
{: .notice--danger}

![SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).](/assets/images/blog/logo-sqlancer.webp "SQLancer (Synthesized Query Lancer) es una herramienta para probar automÃ¡ticamente los sistemas de gestiÃ³n de bases de datos (DBMS) para encontrar errores lÃ³gicos en su implementaciÃ³n. Nos referimos a los errores lÃ³gicos como aquellos errores que hacen que el DBMS obtenga un conjunto de resultados incorrecto (por ejemplo, al omitir un registro).")

[ğŸ Visita Nuestra Tienda ğŸ](https://www.amazon.es/shop/cibercursos){: .btn .btn--warning .btn--large .align-center}{:target="_blank" rel="nofollow,noreferrer"}